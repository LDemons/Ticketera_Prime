{% extends 'base.html' %}
{% load static %}
{% load ticket_tags %}

{% block title %}Ticketera · Mis Notificaciones{% endblock %}

{% block content %}
    <header class="header">
      <h1 class="page-title">Mis Notificaciones</h1>
    </header>

     <main style="padding: 16px;">
        <div class="card">
            <div class="card-head">
                <h2>Historial de Notificaciones</h2>
            </div>
            
            <div style="padding: 15px;">
                {% for noti in notificaciones %}
                
                {# --- INICIO: BLOQUE DE NOTIFICACIÓN MODIFICADO --- #}
                <div class="notificacion-item" style="
                    border-bottom: 1px solid var(--line); 
                    padding: 12px 10px;
                    background: {% if not noti.leido %}var(--blue-100){% else %}transparent{% endif %};
                    
                    /* --- Estilos Flexbox --- */
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    gap: 15px;
                ">
                    
                    <div style="font-size: 16px; color: var(--text);">
                        {% with noti.mensaje|split_at_hash as parts %}
                            {{ parts.0 }} {# Parte antes del # #}
                            {% if parts.1 %}
                                <b>{{ parts.1 }}</b> {# Parte desde el # en negrita #}
                            {% endif %}
                        {% endwith %}
                    </div>

                    <div style="display: flex; align-items: center; gap: 15px; flex-shrink: 0;">
                        <span class="muted small">
                            {{ noti.fecha_creacion|date:"d/m/Y H:i" }}
                        </span>

                        {# --- Botón "Abrir" con URL responsive según dispositivo --- #}
                        <a href="{% ticket_url noti.ticket.ticket_id usuario_rol %}" class="btn-link">Abrir</a>
                    </div>

                </div>
                {# --- FIN: BLOQUE DE NOTIFICACIÓN MODIFICADO --- #}

                {% empty %}
                <div class="bulk-bar" style="margin: 10px 0;">
                    No tienes notificaciones.
                </div>
                {% endfor %}
            </div>
        </div>
     </main>
{% endblock %}